

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Getting started &mdash; nMigen toolchain 0.3.dev160 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  <link rel="stylesheet" href="_static/platformpicker.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
        <script src="_static/platformpicker.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Tutorial" href="tutorial.html" />
    <link rel="prev" title="Installation" href="install.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="cover.html" class="icon icon-home" alt="Documentation Home"> nMigen toolchain
          

          
          </a>

          
            
            
              <div class="version">
                0.3.dev160+g630c0fd
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Language &amp; toolchain</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="intro.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="install.html">Installation</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Getting started</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#a-counter">A counter</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#implementing-a-counter">Implementing a counter</a></li>
<li class="toctree-l4"><a class="reference internal" href="#testing-a-counter">Testing a counter</a></li>
<li class="toctree-l4"><a class="reference internal" href="#converting-a-counter">Converting a counter</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#a-blinking-led">A blinking LED</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="tutorial.html">Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="lang.html">Language guide</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference external" href="https://nmigen.info/nmigen-boards/latest/">Board definitions</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="cover.html">nMigen toolchain</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="cover.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">Language &amp; toolchain</a> &raquo;</li>
        
      <li>Getting started</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/start.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="getting-started">
<h1>Getting started<a class="headerlink" href="#getting-started" title="Permalink to this headline">¶</a></h1>
<p>This section demonstrates the basic nMigen workflow to provide a cursory overview of the language and the toolchain. See the <a class="reference internal" href="tutorial.html"><span class="doc">tutorial</span></a> for a step-by-step introduction to the language, and the <a class="reference internal" href="lang.html"><span class="doc">language guide</span></a> for a detailed explanation of every language construct.</p>
<div class="section" id="a-counter">
<h2>A counter<a class="headerlink" href="#a-counter" title="Permalink to this headline">¶</a></h2>
<p>As a first example, consider a counter with a fixed limit, enable, and overflow. The code for this example is shown below. <a class="reference external" href="_code/up_counter.py">Download</a> and run it:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ python3 up_counter.py
</pre></div>
</div>
<div class="section" id="implementing-a-counter">
<h3>Implementing a counter<a class="headerlink" href="#implementing-a-counter" title="Permalink to this headline">¶</a></h3>
<p>A 16-bit up counter with enable input, overflow output, and a limit fixed at design time can be implemented in nMigen as follows:</p>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">nmigen</span> <span class="kn">import</span> <span class="o">*</span>


<span class="k">class</span> <span class="nc">UpCounter</span><span class="p">(</span><span class="n">Elaboratable</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A 16-bit up counter with a fixed limit.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    limit : int</span>
<span class="sd">        The value at which the counter overflows.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    en : Signal, in</span>
<span class="sd">        The counter is incremented if ``en`` is asserted, and retains</span>
<span class="sd">        its value otherwise.</span>
<span class="sd">    ovf : Signal, out</span>
<span class="sd">        ``ovf`` is asserted when the counter reaches its limit.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">limit</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">limit</span> <span class="o">=</span> <span class="n">limit</span>

        <span class="c1"># Ports</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">en</span>  <span class="o">=</span> <span class="n">Signal</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ovf</span> <span class="o">=</span> <span class="n">Signal</span><span class="p">()</span>

        <span class="c1"># State</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">=</span> <span class="n">Signal</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">elaborate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">platform</span><span class="p">):</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">Module</span><span class="p">()</span>

        <span class="n">m</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">comb</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ovf</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">limit</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">m</span><span class="o">.</span><span class="n">If</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">en</span><span class="p">):</span>
            <span class="k">with</span> <span class="n">m</span><span class="o">.</span><span class="n">If</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ovf</span><span class="p">):</span>
                <span class="n">m</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">sync</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">m</span><span class="o">.</span><span class="n">Else</span><span class="p">():</span>
                <span class="n">m</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">sync</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">m</span>
</pre></div>
</td></tr></table></div>
<p>The reusable building block of nMigen designs is an <code class="docutils literal notranslate"><span class="pre">Elaboratable</span></code>: a Python class that includes HDL signals (<code class="docutils literal notranslate"><span class="pre">en</span></code> and <code class="docutils literal notranslate"><span class="pre">ovf</span></code>, in this case) as a part of its interface, and provides the <code class="docutils literal notranslate"><span class="pre">elaborate</span></code> method that defines its behavior.</p>
<p>Most <code class="docutils literal notranslate"><span class="pre">elaborate</span></code> implementations use a <code class="docutils literal notranslate"><span class="pre">Module</span></code> helper to describe combinatorial (<code class="docutils literal notranslate"><span class="pre">m.d.comb</span></code>) and synchronous (<code class="docutils literal notranslate"><span class="pre">m.d.sync</span></code>) logic controlled with conditional syntax (<code class="docutils literal notranslate"><span class="pre">m.If</span></code>, <code class="docutils literal notranslate"><span class="pre">m.Elif</span></code>, <code class="docutils literal notranslate"><span class="pre">m.Else</span></code>) similar to Python’s. They can also instantiate vendor-defined black boxes or modules written in other HDLs.</p>
</div>
<div class="section" id="testing-a-counter">
<h3>Testing a counter<a class="headerlink" href="#testing-a-counter" title="Permalink to this headline">¶</a></h3>
<p>To verify its functionality, the counter can be simulated for a small amount of time, with a test bench driving it and checking a few simple conditions:</p>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">nmigen.back.pysim</span> <span class="kn">import</span> <span class="n">Simulator</span>


<span class="n">dut</span> <span class="o">=</span> <span class="n">UpCounter</span><span class="p">(</span><span class="mi">25</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">bench</span><span class="p">():</span>
    <span class="c1"># Disabled counter should not overflow.</span>
    <span class="k">yield</span> <span class="n">dut</span><span class="o">.</span><span class="n">en</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">30</span><span class="p">):</span>
        <span class="k">yield</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="p">(</span><span class="k">yield</span> <span class="n">dut</span><span class="o">.</span><span class="n">ovf</span><span class="p">)</span>

    <span class="c1"># Once enabled, the counter should overflow in 25 cycles.</span>
    <span class="k">yield</span> <span class="n">dut</span><span class="o">.</span><span class="n">en</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">25</span><span class="p">):</span>
        <span class="k">yield</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="p">(</span><span class="k">yield</span> <span class="n">dut</span><span class="o">.</span><span class="n">ovf</span><span class="p">)</span>
    <span class="k">yield</span>
    <span class="k">assert</span> <span class="p">(</span><span class="k">yield</span> <span class="n">dut</span><span class="o">.</span><span class="n">ovf</span><span class="p">)</span>

    <span class="c1"># The overflow should clear in one cycle.</span>
    <span class="k">yield</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="p">(</span><span class="k">yield</span> <span class="n">dut</span><span class="o">.</span><span class="n">ovf</span><span class="p">)</span>


<span class="n">sim</span> <span class="o">=</span> <span class="n">Simulator</span><span class="p">(</span><span class="n">dut</span><span class="p">)</span>
<span class="n">sim</span><span class="o">.</span><span class="n">add_clock</span><span class="p">(</span><span class="mf">1e-6</span><span class="p">)</span> <span class="c1"># 1 MHz</span>
<span class="n">sim</span><span class="o">.</span><span class="n">add_sync_process</span><span class="p">(</span><span class="n">bench</span><span class="p">)</span>
<span class="k">with</span> <span class="n">sim</span><span class="o">.</span><span class="n">write_vcd</span><span class="p">(</span><span class="s2">&quot;up_counter.vcd&quot;</span><span class="p">):</span>
    <span class="n">sim</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
<p>The test bench is implemented as a Python generator function that is co-simulated with the counter itself. The test bench can inspect the simulated signals with <code class="docutils literal notranslate"><span class="pre">yield</span> <span class="pre">sig</span></code>, update them with <code class="docutils literal notranslate"><span class="pre">yield</span> <span class="pre">sig.eq(val)</span></code>, and advance the simulation by one clock cycle with <code class="docutils literal notranslate"><span class="pre">yield</span></code>.</p>
<p>When run, the test bench finishes successfully, since all of the assertions hold, and produces a VCD file with waveforms recorded for every <code class="docutils literal notranslate"><span class="pre">Signal</span></code> as well as the clock of the <code class="docutils literal notranslate"><span class="pre">sync</span></code> domain:</p>
<img alt="A screenshot of GTKWave displaying waveforms near the clock cycle where the counter overflows." src="_images/up_counter_gtkwave.png" />
</div>
<div class="section" id="converting-a-counter">
<h3>Converting a counter<a class="headerlink" href="#converting-a-counter" title="Permalink to this headline">¶</a></h3>
<p>Although some nMigen workflows do not include Verilog at all, it is still the de facto standard for HDL interoperability. Any nMigen design can be converted to synthesizable Verilog using the corresponding backend:</p>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>74
75
76
77
78
79</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">nmigen.back</span> <span class="kn">import</span> <span class="n">verilog</span>


<span class="n">top</span> <span class="o">=</span> <span class="n">UpCounter</span><span class="p">(</span><span class="mi">25</span><span class="p">)</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;up_counter.v&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">verilog</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">top</span><span class="p">,</span> <span class="n">ports</span><span class="o">=</span><span class="p">[</span><span class="n">top</span><span class="o">.</span><span class="n">en</span><span class="p">,</span> <span class="n">top</span><span class="o">.</span><span class="n">ovf</span><span class="p">]))</span>
</pre></div>
</td></tr></table></div>
<p>The signals that will be connected to the ports of the top-level Verilog module should be specified explicitly. The rising edge clock and synchronous reset signals of the <code class="docutils literal notranslate"><span class="pre">sync</span></code> domain are added automatically; if necessary, the control signals can be configured explicitly. The result is the following Verilog code (lightly edited for clarity):</p>
<div class="highlight-verilog notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="p">(</span><span class="o">*</span> <span class="n">generator</span> <span class="o">=</span> <span class="s">&quot;nMigen&quot;</span> <span class="o">*</span><span class="p">)</span>
<span class="k">module</span> <span class="n">top</span><span class="p">(</span><span class="n">clk</span><span class="p">,</span> <span class="n">rst</span><span class="p">,</span> <span class="n">en</span><span class="p">,</span> <span class="n">ovf</span><span class="p">);</span>
  <span class="p">(</span><span class="o">*</span> <span class="n">src</span> <span class="o">=</span> <span class="s">&quot;&lt;nmigen-root&gt;/nmigen/hdl/ir.py:526&quot;</span> <span class="o">*</span><span class="p">)</span>
  <span class="k">input</span> <span class="n">clk</span><span class="p">;</span>
  <span class="p">(</span><span class="o">*</span> <span class="n">src</span> <span class="o">=</span> <span class="s">&quot;&lt;nmigen-root&gt;/nmigen/hdl/ir.py:526&quot;</span> <span class="o">*</span><span class="p">)</span>
  <span class="k">input</span> <span class="n">rst</span><span class="p">;</span>
  <span class="p">(</span><span class="o">*</span> <span class="n">src</span> <span class="o">=</span> <span class="s">&quot;up_counter.py:26&quot;</span> <span class="o">*</span><span class="p">)</span>
  <span class="k">input</span> <span class="n">en</span><span class="p">;</span>
  <span class="p">(</span><span class="o">*</span> <span class="n">src</span> <span class="o">=</span> <span class="s">&quot;up_counter.py:27&quot;</span> <span class="o">*</span><span class="p">)</span>
  <span class="k">output</span> <span class="n">ovf</span><span class="p">;</span>
  <span class="p">(</span><span class="o">*</span> <span class="n">src</span> <span class="o">=</span> <span class="s">&quot;up_counter.py:30&quot;</span> <span class="o">*</span><span class="p">)</span>
  <span class="kt">reg</span> <span class="p">[</span><span class="mh">15</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="n">count</span> <span class="o">=</span> <span class="mh">16&#39;h0000</span><span class="p">;</span>
  <span class="p">(</span><span class="o">*</span> <span class="n">src</span> <span class="o">=</span> <span class="s">&quot;up_counter.py:30&quot;</span> <span class="o">*</span><span class="p">)</span>
  <span class="kt">reg</span> <span class="p">[</span><span class="mh">15</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="n">\count$next</span> <span class="p">;</span>
  <span class="p">(</span><span class="o">*</span> <span class="n">src</span> <span class="o">=</span> <span class="s">&quot;up_counter.py:35&quot;</span> <span class="o">*</span><span class="p">)</span>
  <span class="kt">wire</span> <span class="n">\$1</span> <span class="p">;</span>
  <span class="p">(</span><span class="o">*</span> <span class="n">src</span> <span class="o">=</span> <span class="s">&quot;up_counter.py:41&quot;</span> <span class="o">*</span><span class="p">)</span>
  <span class="kt">wire</span> <span class="p">[</span><span class="mh">16</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="n">\$3</span> <span class="p">;</span>
  <span class="p">(</span><span class="o">*</span> <span class="n">src</span> <span class="o">=</span> <span class="s">&quot;up_counter.py:41&quot;</span> <span class="o">*</span><span class="p">)</span>
  <span class="kt">wire</span> <span class="p">[</span><span class="mh">16</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="n">\$4</span> <span class="p">;</span>
  <span class="k">assign</span> <span class="n">\$1</span>  <span class="o">=</span> <span class="n">count</span> <span class="o">==</span> <span class="p">(</span><span class="o">*</span> <span class="n">src</span> <span class="o">=</span> <span class="s">&quot;up_counter.py:35&quot;</span> <span class="o">*</span><span class="p">)</span> <span class="mh">5&#39;h19</span><span class="p">;</span>
  <span class="k">assign</span> <span class="n">\$4</span>  <span class="o">=</span> <span class="n">count</span> <span class="o">+</span> <span class="p">(</span><span class="o">*</span> <span class="n">src</span> <span class="o">=</span> <span class="s">&quot;up_counter.py:41&quot;</span> <span class="o">*</span><span class="p">)</span> <span class="mh">1&#39;h1</span><span class="p">;</span>
  <span class="k">always</span> <span class="p">@(</span><span class="k">posedge</span> <span class="n">clk</span><span class="p">)</span>
      <span class="n">count</span> <span class="o">&lt;=</span> <span class="n">\count$next</span> <span class="p">;</span>
  <span class="k">always</span> <span class="p">@</span><span class="o">*</span> <span class="k">begin</span>
    <span class="n">\count$next</span>  <span class="o">=</span> <span class="n">count</span><span class="p">;</span>
    <span class="p">(</span><span class="o">*</span> <span class="n">src</span> <span class="o">=</span> <span class="s">&quot;up_counter.py:37&quot;</span> <span class="o">*</span><span class="p">)</span>
    <span class="k">casez</span> <span class="p">(</span><span class="n">en</span><span class="p">)</span>
      <span class="cm">/* src = &quot;up_counter.py:37&quot; */</span>
      <span class="mh">1&#39;h1</span><span class="o">:</span>
          <span class="p">(</span><span class="o">*</span> <span class="n">src</span> <span class="o">=</span> <span class="s">&quot;up_counter.py:38&quot;</span> <span class="o">*</span><span class="p">)</span>
          <span class="k">casez</span> <span class="p">(</span><span class="n">ovf</span><span class="p">)</span>
            <span class="cm">/* src = &quot;up_counter.py:38&quot; */</span>
            <span class="mh">1&#39;h1</span><span class="o">:</span>
                <span class="n">\count$next</span>  <span class="o">=</span> <span class="mh">16&#39;h0000</span><span class="p">;</span>
            <span class="cm">/* src = &quot;up_counter.py:40&quot; */</span>
            <span class="k">default</span><span class="o">:</span>
                <span class="n">\count$next</span>  <span class="o">=</span> <span class="n">\$3</span> <span class="p">[</span><span class="mh">15</span><span class="o">:</span><span class="mh">0</span><span class="p">];</span>
          <span class="k">endcase</span>
    <span class="k">endcase</span>
    <span class="p">(</span><span class="o">*</span> <span class="n">src</span> <span class="o">=</span> <span class="s">&quot;&lt;nmigen-root&gt;/nmigen/hdl/xfrm.py:518&quot;</span> <span class="o">*</span><span class="p">)</span>
    <span class="k">casez</span> <span class="p">(</span><span class="n">rst</span><span class="p">)</span>
      <span class="mh">1&#39;h1</span><span class="o">:</span>
          <span class="n">\count$next</span>  <span class="o">=</span> <span class="mh">16&#39;h0000</span><span class="p">;</span>
    <span class="k">endcase</span>
  <span class="k">end</span>
  <span class="k">assign</span> <span class="n">\$3</span>  <span class="o">=</span> <span class="n">\$4</span> <span class="p">;</span>
  <span class="k">assign</span> <span class="n">ovf</span> <span class="o">=</span> <span class="n">\$1</span> <span class="p">;</span>
<span class="k">endmodule</span>
</pre></div>
</td></tr></table></div>
<p>To aid debugging, the generated Verilog code has the same general structure as the nMigen source code (although more verbose), and contains extensive source location information.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Unfortunately, at the moment none of the supported toolchains will use the source location information in diagnostic messages.</p>
</div>
</div>
</div>
<div class="section" id="a-blinking-led">
<h2>A blinking LED<a class="headerlink" href="#a-blinking-led" title="Permalink to this headline">¶</a></h2>
<p>Although nMigen works well as a standalone HDL, it also includes a build system that integrates with FPGA toolchains, and many board definition files for common developer boards that include pinouts and programming adapter invocations. The following code will blink a LED with a frequency of 1 Hz on any board that has a LED and an oscillator:</p>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">nmigen</span> <span class="kn">import</span> <span class="o">*</span>


<span class="k">class</span> <span class="nc">LEDBlinker</span><span class="p">(</span><span class="n">Elaboratable</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">elaborate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">platform</span><span class="p">):</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">Module</span><span class="p">()</span>

        <span class="n">led</span> <span class="o">=</span> <span class="n">platform</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s2">&quot;led&quot;</span><span class="p">)</span>

        <span class="n">half_freq</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">platform</span><span class="o">.</span><span class="n">default_clk_frequency</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">timer</span> <span class="o">=</span> <span class="n">Signal</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">half_freq</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>

        <span class="k">with</span> <span class="n">m</span><span class="o">.</span><span class="n">If</span><span class="p">(</span><span class="n">timer</span> <span class="o">==</span> <span class="n">half_freq</span><span class="p">):</span>
            <span class="n">m</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">sync</span> <span class="o">+=</span> <span class="n">led</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="o">~</span><span class="n">led</span><span class="p">)</span>
            <span class="n">m</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">sync</span> <span class="o">+=</span> <span class="n">timer</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">m</span><span class="o">.</span><span class="n">Else</span><span class="p">():</span>
            <span class="n">m</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">sync</span> <span class="o">+=</span> <span class="n">timer</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="n">timer</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">m</span>
</pre></div>
</td></tr></table></div>
<p>The <code class="docutils literal notranslate"><span class="pre">LEDBlinker</span></code> module will use the first LED available on the board, and derive the clock divisor from the oscillator frequency specified in the clock constraint. It can be used, for example, with the <a class="reference external" href="https://www.latticesemi.com/icestick">Lattice iCEStick evaluation board</a>, one of the many boards already supported by nMigen:</p>
<div class="admonition-todo admonition" id="id1">
<p class="admonition-title">Todo</p>
<p>Link to the installation instructions for the FOSS iCE40 toolchain, probably as a part of board documentation.</p>
</div>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>21
22
23
24</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">nmigen_boards.icestick</span> <span class="kn">import</span> <span class="o">*</span>


<span class="n">ICEStickPlatform</span><span class="p">()</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">LEDBlinker</span><span class="p">(),</span> <span class="n">do_program</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>With only a single line of code, the design is synthesized, placed, routed, and programmed to the on-board Flash memory. Although not all applications will use the nMigen build system, the designs that choose it can benefit from the “turnkey” built-in workflows; if necessary, the built-in workflows can be customized to include user-specified options, commands, and files.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The ability to check with minimal effort whether the entire toolchain functions correctly is so important that it is built into every board definition file. To use it with the iCEStick board, run:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ python3 -m nmigen_boards.icestick
</pre></div>
</div>
<p>This command will build and program a test bitstream similar to the example above.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="tutorial.html" class="btn btn-neutral float-right" title="Tutorial" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="install.html" class="btn btn-neutral float-left" title="Installation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, nMigen developers

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>